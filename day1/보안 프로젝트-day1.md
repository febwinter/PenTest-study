# 보안 프로젝트

모의해킹,웹해킹 --> 진단자의 입장에서 방법은 똑같음

인프라 보안 --> 인프라에 직접 접속해 스크립트 방식으로 점검

**인프라 진단과 모의 해킹은 다른 것이다** 



## 소프트웨어 보안의 필요성
ex) 의료 망 : 스카다 망, IoT 망
ps) 핀테크 : 금융 + IT 기술 = FIN + TECH

- 위와 같이 인프라가 다양화 됨에 따라 보안 취약점도 증대된다.

- 제로데이 취약점 : 취약점 발견 시점을 제로데이(Zero Day)라고 한다.

ex) ms 취약점의 경우 비싼 가격으로 다크웹에서 거래되며 이를 통해 악성코드가 개발된다.



### 용어
- exploit : 공격 코드
- Poc : Proof of concept (개념 정의를 할 정도의 공격코드, 상세하게 정의하지 않고 개념만 정의)
- 1-day 취약점 : 취약점이 발견되었지만 조치되지 않은 경우





## 블랙박스, 화이트박스, 그레이박스
- 모의해킹 관점인지 서비스 관점인지에 따라 다르게 사용하는 용어
- 취약점 분석 평가 관점일 경우..
- 블랙박스 : 도메인 정보만 알고 접근, 점검하는 경우, 비인가자 입장에서의 점검, 도메인과 IP정보만으로 점검 (모의해킹)
- 화이트박스 : 소스코드까지 같이 보면서 점검, 소스코드 진단, 도구를 사용해 진단한다. (진단도구 예시 : Fortify(포트파이), Sparrow(스패로우) --> 사용도구)
- 그레이박스 : 블랙박스와 화이트박스의 사이의 관점, 소스코드를 보면서 모의해킹을 하는 경우



## 웹 해킹 사례

### "여기어때" 개인정보 유출 사건
- SQL Injection 취약점 사례
- 소송 중
- 아직까지 징벌적 손해배상제, 법정손해배상제가 적용되지 않아 적용될지 주목됨
- 외부 유출 사례

### 카드 3사 개인정보 유출 사건(2014년)
- 내부 협력사 유출(외부 유출 x)
- (참고) FDS(Fraud Detection System) : 신용카드 부정사용 방지 시스템
- 테스트 데이터를 제공했어야 하나 실 데이터를 제공함



# 온프레미스와 클라우드 서비스 보안



## 방화벽/VPN

* 주로 인프라 부서에서 관리함



## IDS/IPS

- IDS : 침입 탐지 시스템
- IPS : 침입 방지 시스템



## DMZ 망

- 최소한의 보안이 갖추어진 망



## 업무망

- 정보시스템부서, 일반업무부서로 나뉨

- 정보시스템 부서 : IT센터라 볼수 있다. 주로 중요 내부 망에 접속하게 되어있다. 때문에 **"망분리"**가 되어있다.

  * 망분리 : 업무망과 인터넷 망을 분리하는 것

    -  논리적 망분리 : 가상환경 (업무망, 인터넷망)
    - 물리적 망분리 : PC 2대

    업무망 <------------------- USB, 망연계망 솔루션 -------------------> 인터넷망

    망 연계망 : 소프트웨어적 망분리

  * 접근통제 솔루션 : 방화벽과 비슷하나 방화벽에 인증(접근하는 사용자에게 어떤 권한을 줄것인가)이 추가된다.

## Intra Zone

* 클라우드로 전환할 경우 이 부분이 필요 없게 된다.
* 다만 비용을 많이 지불해야 한다.



#### 참고

- GCP : 내부적인 기술을 외부에 공개하는 경우가 많음 

  ex) 유튜브 검색 플랫폼, 쿠버네티스, 머신러닝 등



# AWS 클라우드 인프라



## 주요 구성요소

- Internet Gateway : 라우터 역할
- VPC : 클라우드 내 네트워크, 망분리 기능을 가지고 있음
- Subnet : VPC 아래에서 용도별로 망을 분리한다.
- AWS Cloud Watch : AWS 모니터링, ELK와 같은 역할, 로그 수집



## 보안관제 시스템의 위치

- AWS 시스템 내부에 구축됨
  - 로그수집 및 S3에 저장
  - AWS 내부에서 관리 : 구조 간단, 비용 증가
- AWS 시스템 내부에 구축, 관제는 VPC를 통해 로그를 외부로 내보내 진행
  - 내부에서 로그 수집
  - S3에 로그 저장
  - 저장된 로그를 VPC를 통해 외부로 내보내 관제 : 비용은 줄어드나 VPC 사용료가 별도로 들게 됨





# 모의 해킹 진단 프로세스 이해



## 정보수집 단계

### penetration test (pentest)

1. 사전협의 단계 
   - 고객 협의 단계
   - 언제, 누가, 어떻게 점검할지 정하는 것
2. 정보수집단계
   - 공개된 모든 웹 서비스에 대해 정보를 수집함
3. 위협모델링 단계
   - 정보 수집을 통해 얻은 정보에서 취약점을 분류하는 단계
4. 취약점 분석 단계
   - 취약점 분석
5. 침투 단계
   - 찾아낸 취약점에 대한 침투 단계
6. 내부 침투단계
   - 내부 서비스 더 깊은 곳까지 침투



* 시스템 침투도 동일한 방식으로 진행된다.



## 칼리 리눅스 실습



## 칼리 리눅스의 도구들

 칼리 리눅스의 도구들은 모의 해킹의 방법론에 따라 만들어졌다.

1. 정보수집
2. 취약점 분석
3. 웹 어플리케이션
4. 패스워드 공격
5. 무선 공격
6. Exploitation Tool
7. 스니핑/스푸핑
8. maintaing access
9. 리버스 엔지니어링
10. 하드웨어 해킹
11. 포렌식
12. 리포팅



## 진단 가이드 (보안 가이드)

### OWASP Top 10

- Open-Source Application Security Project
- 웹표준 보안기구 OWASP기구, 한국지사 있음
- OWASP-JAP 이라는 
- AWS도 이를 기반으로 점검한다.

### 주요정보통신기반시설 기술적 취약점 분석 평가 상세 가이드

- 과학기술정보통신부, 한국인터넷진흥원

### 전자정부 SW 개발 운영자를 위한 소프트웨어 개발 보안 가이드

- 행정안전부, 한국인터넷진흥원



## 서브도메인 검색의 중요성

다음과 같은 경우가 존재한다. 따라서 정보 수집을 통해 이를 파악해야 한다.

- 같은 IP 다른 도메인 이름
- 다른 IP 같은 도메인 이름

### 정기적 취약점 진단

- 금융권의 경우 2개월 마다 한번씩 진단을 받아야 한다.



#### 용어

- ACL : 접근 제어 목록



# 쇼단 검색 서비스 이해

### OSINT

오픈소스 서비스



## Shodan

- 데이터 노출 검색 서비스
- 도메인 정보를 주기적으로 크롤링해 가져와 보여준다.
- 옵션에 따라 여러 정보를 검색 가능하다.

* 포트가 열려있을 경우 Shodan에 크롤링되어 보여지게 된다.
* 열려있는 **포트**를 확인할 수 있다. 이를 확인하고 빠른 대응이 가능하다.
* 검색옵션 SaaS 교재 6페이지 참조



### Shodan 카테고리 

### 스카다(scada) 망

- 산업 기반 망

- IoT 기반 보안관제의 핵심이 되는 망
- 오래된 설비들을 대상으로 하는 망

### 데이터베이스

- 데이터베이스 포트 관련

### 비디오 게임

- 상당히 많은 수의 개인 PC가 검색된다.
- 해당 개인 PC들을 대상으로 공격이 이루어 질 경우 상당히 큰 파장이 생길수 있다.



# AWS S3



## 버킷 생성시 기본적 보안

![image-20200831153019648](C:\Users\Kim Hae Inn\AppData\Roaming\Typora\typora-user-images\image-20200831153019648.png)

- 객체수준 로깅 
- 기본 암호화를 통해 암호화

## 퍼블릭 엑세스  차단

![image-20200831153259619](C:\Users\Kim Hae Inn\AppData\Roaming\Typora\typora-user-images\image-20200831153259619.png)

- 게시판 같은 내용을 작성하기 위해서는 퍼블릭으로 열어야 한다.
- 일반적으로는 퍼블릭 액세스가 되도록 하면 검색되기 시작하기 때문에 주의

## 검색을 통한 Bucket 공격

- https://buckets.grayhatwarfare.com/
- Shodan python api를 통한 공격
- 키워드에 대한 S3 정보를 수집한다



# Shodan Python API 활용

## 사용 사례

- 멀웨어/ 바이러스 검색, 치료
- 웹사이트 명성 진단
- 공격영역 탐색
- 버그바운티 (ex NAVER)

##  설치

- pip install shodan
- shodan init [쇼단 키]

## 명령어

### myip

-  shodan myip : 자신의 외부 IP

### host

- shodan host [대상 IP] : 해당 호스트 IP 관련 정보, 대상 호스트의 취약점을 취약점 데이터베이스 (CVE 데이터베이스)에서 찾아 표시해준다.
  - CVE 데이터베이스 표기법 : CVE-년도-번호 ex) cve-2012-2532
- shodan host --hitory [대상 IP] : --history  옵션을 통해서 이전의 방화벽과 같은 곳에 어떤 변화가 일어났는지 확인 가능하다.

### search

- shodan search [서비스명] : 해당 서비스에 대한 
- shodan search --fields [ip_str,port,hostnames] [서비스명] : --fields 옵션을 통해 해당 필드 정보만 가져와 출력한다.

### stats

- shodan stats --facets [정렬값] [검색 옵션] : 검색 옵션에대한 결과를 정렬값에 대해 내림차순으로 정렬해 보여줌



# 퀴즈 : shodan stats --facets 사용

- 고객서비스 C클라스에서 오픈되어있는 포트는?

```bash
# shodan stats --facets port net:70.37.50.0/24
```

- 한국에서 제일 많이 열려있는 포트는?

```bash
# shodan stats --facets port country:KR
```

- 고객서비스 C클라스에서 많이 노출되는 취약점 사례는?

```bash
# shodan stats --facets vuln net:70.37.50.0/24
```



## CVE vs CWE

- CVE 는 취약점
- CWE는 약점. PoC로 정의가 가능한 경우 CVE로 등록된다. 
- CWE는 기본적으로 CVE에 비해 약한 개념 





### parse

- 다운받은 데이터에 대해서 parsing을 실행한다.
- shodan parse --fields ip_str,port [데이터 파일]
- 결과가 화면에 parsing 되어 출력된다.

![image-20200831174646263](C:\Users\Kim Hae Inn\AppData\Roaming\Typora\typora-user-images\image-20200831174646263.png)



### convert

- 엑셀 파일을 변환하여 이미지로 만들수 있다.

![image-20200831174825799](C:\Users\Kim Hae Inn\AppData\Roaming\Typora\typora-user-images\image-20200831174825799.png)

- 다음과 같이 사진 파일로 만들어진다.

![image-20200831174848344](C:\Users\Kim Hae Inn\AppData\Roaming\Typora\typora-user-images\image-20200831174848344.png)